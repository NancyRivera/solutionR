!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery","./grid.base","jquery-ui/dialog","jquery-ui/draggable","jquery-ui/droppable","jquery-ui/resizable","jquery-ui/sortable","./addons/ui.multiselect"],t):t(jQuery)}(function($){"use strict";var setSelected;$.jgrid.msie()&&8===$.jgrid.msiever()&&($.expr[":"].hidden=function(t){return 0===t.offsetWidth||0===t.offsetHeight||"none"===t.style.display}),$.jgrid._multiselect=!1,$.ui&&$.ui.multiselect&&($.ui.multiselect.prototype._setSelected&&(setSelected=$.ui.multiselect.prototype._setSelected,$.ui.multiselect.prototype._setSelected=function(t,e){var i,t=setSelected.call(this,t,e);return e&&this.selectedList&&(i=this.element,this.selectedList.find("li").each(function(){$(this).data("optionLink")&&$(this).data("optionLink").remove().appendTo(i)})),t}),$.ui.multiselect.prototype.destroy&&($.ui.multiselect.prototype.destroy=function(){this.element.show(),this.container.remove(),(void 0===$.Widget?$.widget:$.Widget).prototype.destroy.apply(this,arguments)}),$.jgrid._multiselect=!0),$.jgrid.extend({sortableColumns:function(r){return this.each(function(){var d=this,t=$.jgrid.jqID(d.p.id),e=!1;function i(){d.p.disableClick=!0,d.p.frozenColumns&&($(d).jqGrid("destroyFrozenColumns"),e=!0)}function s(){setTimeout(function(){d.p.disableClick=!1,e&&($(d).jqGrid("setFrozenColumns"),e=!1)},50)}var o,a,t={tolerance:"pointer",axis:"x",scrollSensitivity:"1",items:">th:not(:has(#jqgh_"+t+"_cb,#jqgh_"+t+"_rn,#jqgh_"+t+"_subgrid),:hidden)",cancel:".sortable-disabled",placeholder:{element:function(t){return $(document.createElement(t[0].nodeName)).addClass(t[0].className+" ui-sortable-placeholder ui-state-highlight").removeClass("ui-sortable-helper")[0]},update:function(t,e){e.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),e.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10))}},update:function(t,e){var i=$(e.item).parent(),e=$(">th",i),i=d.p.colModel,s={},o=d.p.id+"_";$.each(i,function(t){s[this.name]=t});var a=[];e.each(function(){var t=$(">div",this).get(0).id.replace(/^jqgh_/,"").replace(o,"");s.hasOwnProperty(t)&&a.push(s[t])}),$(d).jqGrid("remapColumns",a,!0,!0),$.jgrid.isFunction(d.p.sortable.update)&&d.p.sortable.update(a)}};d.p.sortable.options?$.extend(t,d.p.sortable.options):$.jgrid.isFunction(d.p.sortable)&&(d.p.sortable={update:d.p.sortable}),t.start?(o=t.start,t.start=function(t,e){i(),o.call(this,t,e)}):t.start=i,t.stop?(a=t.stop,t.stop=function(t,e){s(),a.call(this,t,e)}):t.stop=s,d.p.sortable.exclude&&(t.items+=":not("+d.p.sortable.exclude+")");t=r.sortable(t),t=t.data("sortable")||t.data("uiSortable");null!=t&&(t.data("sortable").floating=!0)})},columnChooser:function(e){var i,s,t,o=this,d={},a=[],r=o.jqGrid("getGridParam","colModel"),n=o.jqGrid("getGridParam","colNames"),l=function(t){return $.ui.multiselect.prototype&&t.data($.ui.multiselect.prototype.widgetFullName||$.ui.multiselect.prototype.widgetName)||t.data("ui-multiselect")||t.data("multiselect")},c=$.jgrid.getRegional(this[0],"col");if(!$("#colchooser_"+$.jgrid.jqID(o[0].p.id)).length){if(i=$('<div id="colchooser_'+o[0].p.id+'" style="position:relative;overflow:hidden"><div><select multiple="multiple"></select></div></div>'),s=$("select",i),e=$.extend({width:400,height:240,classname:null,done:function(t){t&&o.jqGrid("remapColumns",t,!0)},msel:"multiselect",dlog:"dialog",dialog_opts:{minWidth:470,dialogClass:"ui-jqdialog"},dlog_opts:function(t){var e={};return e[t.bSubmit]=function(){t.apply_perm(),t.cleanup(!1)},e[t.bCancel]=function(){t.cleanup(!0)},$.extend(!0,{buttons:e,close:function(){t.cleanup(!0)},modal:t.modal||!1,resizable:t.resizable||!0,width:t.width+70,resize:u},t.dialog_opts||{})},apply_perm:function(){var a=[];$("option",s).each(function(){$(this).is(":selected")?o.jqGrid("showCol",r[this.value].name):o.jqGrid("hideCol",r[this.value].name)}),$("option[selected]",s).each(function(){a.push(parseInt(this.value,10))}),$.each(a,function(){delete d[r[parseInt(this,10)].name]}),$.each(d,function(){var t,e,i,s,o=parseInt(this,10);t=a,i=e=o,a=0<=e?(o=(s=t.slice()).splice(e,Math.max(t.length-e,e)),e>t.length&&(e=t.length),s[e]=i,s.concat(o)):t}),e.done&&e.done.call(o,a),o.jqGrid("setGridWidth",o[0].p.width,o[0].p.shrinkToFit)},cleanup:function(t){p(e.dlog,i,"destroy"),p(e.msel,s,"destroy"),i.remove(),t&&e.done&&e.done.call(o)},msel_opts:{}},c,e||{}),$.ui&&$.ui.multiselect&&$.ui.multiselect.defaults){if(!$.jgrid._multiselect)return void alert("Multiselect plugin loaded after jqGrid. Please load the plugin before the jqGrid!");e.msel_opts=$.extend($.ui.multiselect.defaults,e.msel_opts)}e.caption&&i.attr("title",e.caption),e.classname&&(i.addClass(e.classname),s.addClass(e.classname)),e.width&&($(">div",i).css({width:e.width,margin:"0 auto"}),s.css("width",e.width)),e.height&&($(">div",i).css("height",e.height),s.css("height",e.height-10)),s.empty(),$.each(r,function(t){d[this.name]=t,this.hidedlg?this.hidden||a.push(t):s.append("<option value='"+t+"' "+(this.hidden?"":"selected='selected'")+">"+$.jgrid.stripHtml(n[t])+"</option>")}),t=$.jgrid.isFunction(e.dlog_opts)?e.dlog_opts.call(o,e):e.dlog_opts,p(e.dlog,i,t),c=$.jgrid.isFunction(e.msel_opts)?e.msel_opts.call(o,e):e.msel_opts,p(e.msel,s,c),t=$("#colchooser_"+$.jgrid.jqID(o[0].p.id));var c=$(".ui-jqgrid").css("font-size")||"11px";t.parent().css("font-size",c),t.css({margin:"auto"}),t.find(">div").css({width:"100%",height:"100%",margin:"auto"}),(c=l(s)).container.css({width:"100%",height:"100%",margin:"auto"}),c.selectedContainer.css({width:100*c.options.dividerLocation+"%",height:"100%",margin:"auto",boxSizing:"border-box"}),c.availableContainer.css({width:100-100*c.options.dividerLocation+"%",height:"100%",margin:"auto",boxSizing:"border-box"}),c.selectedList.css("height","auto"),c.availableList.css("height","auto"),t=Math.max(c.selectedList.height(),c.availableList.height()),t=Math.min(t,$(window).height()),c.selectedList.css("height",t),c.availableList.css("height",t),u()}function p(t,e){t&&("string"==typeof t?$.fn[t]&&$.fn[t].apply(e,$.makeArray(arguments).slice(2)):$.jgrid.isFunction(t)&&t.apply(e,$.makeArray(arguments).slice(2)))}function u(){var t=l(s),e=t.container.closest(".ui-dialog-content");0<e.length&&"object"==typeof e[0].style?e[0].style.width="":e.css("width",""),t.selectedList.height(Math.max(t.selectedContainer.height()-t.selectedActions.outerHeight()-1,1)),t.availableList.height(Math.max(t.availableContainer.height()-t.availableActions.outerHeight()-1,1))}},sortableRows:function(o){return this.each(function(){var s=this;s.grid&&(s.p.treeGrid||$.fn.sortable&&((o=$.extend({cursor:"move",axis:"y",items:" > .jqgrow"},o||{})).start&&$.jgrid.isFunction(o.start)?(o._start_=o.start,delete o.start):o._start_=!1,o.update&&$.jgrid.isFunction(o.update)?(o._update_=o.update,delete o.update):o._update_=!1,o.start=function(t,e){if($(e.item).css("border-width","0"),$("td",e.item).each(function(t){this.style.width=s.grid.cols[t].style.width}),s.p.subGrid){var i=$(e.item).attr("id");try{$(s).jqGrid("collapseSubGridRow",i)}catch(t){}}o._start_&&o._start_.apply(this,[t,e])},o.update=function(t,e){$(e.item).css("border-width",""),!0===s.p.rownumbers&&$("td.jqgrid-rownum",s.rows).each(function(t){$(this).html(t+1+(parseInt(s.p.page,10)-1)*parseInt(s.p.rowNum,10))}),o._update_&&o._update_.apply(this,[t,e])},$(s).find("tbody").first().sortable(o),$("tbody",s).first().find(" > .jqgrow").disableSelection()))})},gridDnD:function(s){return this.each(function(){var t,e,a=this;if(a.grid&&!a.p.treeGrid&&$.fn.draggable&&$.fn.droppable){var h;if(void 0===$("#jqgrid_dnd")[0]&&$("body").append("<table id='jqgrid_dnd' class='ui-jqgrid-dnd'></table>"),"string"!=typeof s||"updateDnD"!==s||!0!==a.p.jqgdnd){if((s=$.extend({drag:function(o){return $.extend({start:function(t,e){var i,s;if(a.p.subGrid){s=$(e.helper).attr("id");try{$(a).jqGrid("collapseSubGridRow",s)}catch(t){}}for(i=0;i<$.data(a,"dnd").connectWith.length;i++)0===$($.data(a,"dnd").connectWith[i]).jqGrid("getGridParam","reccount")&&$($.data(a,"dnd").connectWith[i]).jqGrid("addRowData","jqg_empty_row",{});e.helper.addClass("ui-state-highlight"),$("td",e.helper).each(function(t){this.style.width=a.grid.headers[t].width+"px"}),o.onstart&&$.jgrid.isFunction(o.onstart)&&o.onstart.call($(a),t,e)},stop:function(t,e){var i,s;for(e.helper.dropped&&!o.dragcopy&&(void 0===(s=$(e.helper).attr("id"))&&(s=$(this).attr("id")),$(a).jqGrid("delRowData",s)),i=0;i<$.data(a,"dnd").connectWith.length;i++)$($.data(a,"dnd").connectWith[i]).jqGrid("delRowData","jqg_empty_row");o.onstop&&$.jgrid.isFunction(o.onstop)&&o.onstop.call($(a),t,e)}},o.drag_opts||{})},drop:function(u){return $.extend({accept:function(t){if(!$(t).hasClass("jqgrow"))return t;h=$(t).closest("table.ui-jqgrid-btable");var e=$(this).find("table.ui-jqgrid-btable").first()[0];if(0<h.length&&void 0!==$.data(h[0],"dnd")){t=$.data(h[0],"dnd").connectWith;return-1!==$.inArray("#"+$.jgrid.jqID(e.id),t)}return!1},drop:function(t,e){if($(e.draggable).hasClass("jqgrow")){var i,s=$(e.draggable).attr("id"),o=e.draggable.parent().parent().jqGrid("getRowData",s),a=[],d=$(this).find("table.ui-jqgrid-btable").first()[0];if($.isPlainObject(o)&&(a=Object.keys(o)),!u.dropbyname){var r,n,l={},c=0,p=$("#"+$.jgrid.jqID(d.id)).jqGrid("getGridParam","colModel");try{for(r=0;r<p.length;r++)"cb"!==(n=p[r].name)&&"rn"!==n&&"subgrid"!==n&&(void 0!==a[c]&&(l[n]=o[a[c]]),c++);o=l}catch(t){}}e.helper.dropped=!0,$.data(h[0],"dnd").beforedrop&&$.jgrid.isFunction($.data(h[0],"dnd").beforedrop)&&(null!=(s=$.data(h[0],"dnd").beforedrop.call(d,t,e,o,$(h[0]),$(d)))&&"object"==typeof s&&(o=s)),e.helper.dropped&&(u.autoid&&(i=$.jgrid.isFunction(u.autoid)?u.autoid.call(d,o):(i=Math.ceil(1e3*Math.random()),u.autoidprefix+i)),$("#"+$.jgrid.jqID(d.id)).jqGrid("addRowData",i,o,u.droppos)),u.ondrop&&$.jgrid.isFunction(u.ondrop)&&u.ondrop.call(d,t,e,o)}}},u.drop_opts||{})},onstart:null,onstop:null,beforedrop:null,ondrop:null,drop_opts:{activeClass:"ui-state-active",hoverClass:"ui-state-hover",tolerance:"intersect"},drag_opts:{revert:"invalid",helper:"clone",cursor:"move",appendTo:"#jqgrid_dnd",zIndex:5e3},dragcopy:!1,dropbyname:!1,droppos:"first",autoid:!0,autoidprefix:"dnd_"},s||{})).connectWith)for(s.connectWith=s.connectWith.split(","),s.connectWith=$.map(s.connectWith,function(t){return $.jgrid.trim(t)}),$.data(a,"dnd",s),0===a.p.reccount||a.p.jqgdnd||i(),a.p.jqgdnd=!0,t=0;t<s.connectWith.length;t++)e=s.connectWith[t],$(e).closest(".ui-jqgrid-bdiv").droppable($.jgrid.isFunction(s.drop)?s.drop.call($(a),s):s.drop)}else i()}function i(){var t=$.data(a,"dnd");$("tr.jqgrow:not(.ui-draggable)",a).draggable($.jgrid.isFunction(t.drag)?t.drag.call($(a),t):t.drag)}})},gridResize:function(opts){return this.each(function(){var $t=this,gID=$.jgrid.jqID($t.p.id),req,class_to_add,test,optstest;$t.grid&&$.fn.resizable&&(opts=$.extend({},{resizeclass:"ui-resizable-icon"},opts||{}),opts.alsoResize?(opts._alsoResize_=opts.alsoResize,delete opts.alsoResize):opts._alsoResize_=!1,opts.stop&&$.jgrid.isFunction(opts.stop)?(opts._stop_=opts.stop,delete opts.stop):opts._stop_=!1,class_to_add=opts.resizeclass,"jQueryUI"!==$t.p.styleUI&&(opts.handles?opts.handles.se?class_to_add+=" "+opts.handles.se.replace(".",""):opts.handles.se="."+class_to_add:(opts.handles={},test=class_to_add.split(" "),opts.handles.se="."+test[0]),class_to_add+=" ui-resizable-se ui-resizable-handle",$("#gbox_"+gID).append('<span class="'+class_to_add+'"></span>')),opts.stop=function(t,e){$($t).jqGrid("setGridParam",{height:$("#gview_"+gID+" .ui-jqgrid-bdiv").height()}),$($t).jqGrid("setGridWidth",e.size.width,opts.shrinkToFit),opts._stop_&&opts._stop_.call($t,t,e),$t.p.caption&&$("#gbox_"+gID).css({height:"auto"}),$t.p.frozenColumns&&(req&&clearTimeout(req),req=setTimeout(function(){req&&clearTimeout(req),$("#"+gID).jqGrid("destroyFrozenColumns"),$("#"+gID).jqGrid("setFrozenColumns")}))},opts._alsoResize_?(optstest="{'#gview_"+gID+" .ui-jqgrid-bdiv':true,'"+opts._alsoResize_+"':true}",opts.alsoResize=eval("("+optstest+")")):opts.alsoResize=$(".ui-jqgrid-bdiv","#gview_"+gID),delete opts._alsoResize_,$("#gbox_"+gID).resizable(opts))})}})});